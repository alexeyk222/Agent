"""
–≠—Ç–∏—á–µ—Å–∫–∏–π —Ñ–∏–ª—å—Ç—Ä –¥–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –∫—Ä–∏–∑–∏—Å–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏–π
"""
import re
from typing import Tuple


class EthicalFilter:
    """–§–∏–ª—å—Ç—Ä –¥–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –∫—Ä–∏–∑–∏—Å–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π"""
    
    # –¢—Ä–∏–≥–≥–µ—Ä–Ω—ã–µ —Ñ—Ä–∞–∑—ã –∏ –ø–∞—Ç—Ç–µ—Ä–Ω—ã
    CRISIS_KEYWORDS = [
        r'–Ω–µ\s+—Ö–æ—á—É\s+–∂–∏—Ç—å',
        r'—Ö–æ—á—É\s+—É–º–µ—Ä–µ—Ç—å',
        r'–ø–æ–∫–æ–Ω—á–∏—Ç—å\s+—Å\s+—Å–æ–±–æ–π',
        r'—Å—É–∏—Ü–∏–¥',
        r'—Å–∞–º–æ—É–±–∏–π—Å—Ç–≤',
        r'–∫–æ–Ω—á–∏—Ç—å\s+–∂–∏–∑–Ω—å',
        r'—É–±–∏—Ç—å\s+—Å–µ–±—è',
        r'–±–æ–ª—å—à–µ\s+–Ω–µ\s+–≤—ã–¥–µ—Ä–∂—É',
        r'–≤—Å—ë\s+–±–µ—Å–ø–æ–ª–µ–∑–Ω–æ',
        r'–ª—É—á—à–µ\s+–±—ã\s+–º–µ–Ω—è\s+–Ω–µ\s+–±—ã–ª–æ',
        r'–Ω–µ\s+–≤–∏–∂—É\s+—Å–º—ã—Å–ª–∞',
        r'–≤—Å—ë\s+–∫–æ–Ω—á–µ–Ω–æ',
        r'–∫–æ–Ω–µ—Ü\s+–≤—Å–µ–º—É',
        r'–Ω–µ\s+–≤—ã–¥–µ—Ä–∂—É',
        r'–Ω–µ\s+–º–æ–≥—É\s+–±–æ–ª—å—à–µ',
        r'—Ö–≤–∞—Ç–∏—Ç\s+–≤—Å—ë',
    ]
    
    # –ì–æ—Ä—è—á–∏–µ –ª–∏–Ω–∏–∏ –ø–æ–º–æ—â–∏ (–†–æ—Å—Å–∏—è)
    HELPLINES = [
        {
            'name': '–¢–µ–ª–µ—Ñ–æ–Ω –¥–æ–≤–µ—Ä–∏—è',
            'phone': '8-800-2000-122',
            'description': '–ï–¥–∏–Ω—ã–π –æ–±—â–µ—Ä–æ—Å—Å–∏–π—Å–∫–∏–π —Ç–µ–ª–µ—Ñ–æ–Ω –¥–æ–≤–µ—Ä–∏—è –¥–ª—è –¥–µ—Ç–µ–π, –ø–æ–¥—Ä–æ—Å—Ç–∫–æ–≤ –∏ –∏—Ö —Ä–æ–¥–∏—Ç–µ–ª–µ–π'
        },
        {
            'name': '–ö—Ä–∏–∑–∏—Å–Ω–∞—è –ª–∏–Ω–∏—è –ø–æ–º–æ—â–∏',
            'phone': '8-495-989-50-50',
            'description': '–ú–æ—Å–∫–æ–≤—Å–∫–∞—è —Å–ª—É–∂–±–∞ –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–π –ø–æ–º–æ—â–∏'
        },
        {
            'name': '–¢–µ–ª–µ—Ñ–æ–Ω –¥–æ–≤–µ—Ä–∏—è –ú–ß–°',
            'phone': '8-495-989-50-50',
            'description': '–ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –ø–æ–º–æ—â—å –≤ –∫—Ä–∏–∑–∏—Å–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö'
        }
    ]
    
    def __init__(self):
        # –ö–æ–º–ø–∏–ª–∏—Ä—É–µ–º —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è
        self.patterns = [re.compile(pattern, re.IGNORECASE) for pattern in self.CRISIS_KEYWORDS]
    
    def check_message(self, message: str) -> Tuple[bool, str]:
        """
        –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–∞ –∫—Ä–∏–∑–∏—Å–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏
        
        Returns:
            (is_crisis, response_message)
        """
        message_lower = message.lower()
        
        for pattern in self.patterns:
            if pattern.search(message_lower):
                return True, self._generate_crisis_response()
        
        return False, ""
    
    def _generate_crisis_response(self) -> str:
        """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ø–æ–º–æ—â–∏"""
        response = "–Ø –≤–∏–∂—É, —á—Ç–æ —Ç–µ–±–µ —Å–µ–π—á–∞—Å –æ—á–µ–Ω—å —Ç—è–∂–µ–ª–æ. –≠—Ç–æ –Ω–µ –∏–≥—Ä–∞, –∏ —è –Ω–µ –º–æ–≥—É –ø–æ–º–æ—á—å –≤ —Ç–∞–∫–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏.\n\n"
        response += "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–±—Ä–∞—Ç–∏—Å—å –∑–∞ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–π –ø–æ–º–æ—â—å—é:\n\n"
        
        for helpline in self.HELPLINES:
            response += f"üìû {helpline['name']}: {helpline['phone']}\n"
            response += f"   {helpline['description']}\n\n"
        
        response += "–¢—ã –Ω–µ –æ–¥–∏–Ω. –ï—Å—Ç—å –ª—é–¥–∏, –∫–æ—Ç–æ—Ä—ã–µ –≥–æ—Ç–æ–≤—ã –ø–æ–º–æ—á—å.\n"
        response += "–ò–≥—Ä–∞ –±—É–¥–µ—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞ –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ —Ç—ã –Ω–µ –æ–±—Ä–∞—Ç–∏—à—å—Å—è –∑–∞ –ø–æ–º–æ—â—å—é."
        
        return response
    
    def get_helplines_json(self) -> list:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≥–æ—Ä—è—á–∏—Ö –ª–∏–Ω–∏–π –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON"""
        return self.HELPLINES

